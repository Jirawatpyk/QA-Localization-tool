<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>qa-localization-tool — Command Palette (Ctrl+K) Mockup</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');

  /* ===== Design Tokens ===== */
  :root {
    --primary: #4F46E5;
    --primary-light: #6366F1;
    --primary-dark: #4338CA;
    --bg: #0F172A;
    --card: #1E293B;
    --border: #334155;
    --text: #F1F5F9;
    --text-secondary: #94A3B8;
    --muted: #64748B;
    --pass: #10B981;
    --review: #F59E0B;
    --fail: #EF4444;
    --hover: #253348;
    --active: #2D3D55;
    --surface-raised: #283548;
  }

  /* ===== Reset & Base ===== */
  *, *::before, *::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
    background: var(--bg);
    color: var(--text);
    height: 100vh;
    overflow: hidden;
    position: relative;
  }

  .mono {
    font-family: 'JetBrains Mono', monospace;
  }

  /* ===== Background (Review View — blurred) ===== */
  #background-view {
    position: fixed;
    inset: 0;
    display: flex;
    filter: blur(4px);
    opacity: 0.3;
    transition: filter 0.3s ease, opacity 0.3s ease;
    pointer-events: none;
  }

  #background-view.clear {
    filter: blur(0px);
    opacity: 1;
    pointer-events: auto;
  }

  /* Sidebar */
  .bg-sidebar {
    width: 48px;
    background: #0B1120;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px 0;
    gap: 8px;
    flex-shrink: 0;
  }

  .bg-sidebar-logo {
    width: 32px;
    height: 32px;
    background: var(--primary);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 700;
    font-size: 14px;
  }

  .bg-sidebar-divider {
    width: 20px;
    height: 1px;
    background: #1E293B;
    margin: 4px 0;
  }

  .bg-sidebar-icon {
    width: 34px;
    height: 34px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--muted);
  }

  .bg-sidebar-icon.active {
    background: var(--card);
    color: var(--text);
  }

  /* Main area */
  .bg-main {
    flex: 1;
    display: flex;
    flex-direction: column;
    min-width: 0;
  }

  /* Top bar */
  .bg-topbar {
    height: 44px;
    background: var(--card);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    flex-shrink: 0;
  }

  .bg-breadcrumb {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: var(--muted);
  }

  .bg-breadcrumb .current {
    color: var(--text);
    font-weight: 500;
  }

  .bg-breadcrumb .sep {
    color: var(--border);
  }

  .bg-score-badge {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .bg-score-num {
    font-size: 22px;
    font-weight: 700;
    color: var(--review);
    font-variant-numeric: tabular-nums;
  }

  /* Filter bar */
  .bg-filterbar {
    height: 32px;
    background: var(--card);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: 0 16px;
    gap: 8px;
    font-size: 12px;
    color: var(--muted);
    flex-shrink: 0;
  }

  .bg-filter-pill {
    padding: 2px 10px;
    border: 1px solid var(--border);
    border-radius: 4px;
    background: var(--bg);
    color: var(--text-secondary);
    font-size: 11px;
  }

  /* Finding list rows */
  .bg-content {
    flex: 1;
    overflow: hidden;
  }

  .bg-finding-row {
    height: 40px;
    display: flex;
    align-items: center;
    padding: 0 16px;
    gap: 12px;
    border-bottom: 1px solid rgba(51, 65, 85, 0.5);
    font-size: 13px;
  }

  .bg-finding-row:nth-child(odd) {
    background: rgba(30, 41, 59, 0.5);
  }

  .bg-finding-num {
    width: 24px;
    font-size: 11px;
    color: var(--muted);
    font-variant-numeric: tabular-nums;
    text-align: right;
  }

  .bg-severity-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
  }

  .bg-severity-dot.critical { background: var(--fail); }
  .bg-severity-dot.major { background: #EA580C; }
  .bg-severity-dot.minor { background: #CA8A04; }

  .bg-finding-text {
    flex: 1;
    font-size: 12px;
    color: var(--text-secondary);
    font-family: 'JetBrains Mono', monospace;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
  }

  .bg-finding-status {
    font-size: 11px;
    color: var(--muted);
  }

  /* Bottom status bar */
  .bg-statusbar {
    height: 28px;
    background: #0B1120;
    border-top: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    font-size: 11px;
    color: var(--muted);
    flex-shrink: 0;
  }

  /* ===== Overlay Backdrop ===== */
  #palette-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.55);
    z-index: 100;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding-top: 100px;
    transition: opacity 0.15s ease;
  }

  #palette-backdrop.hidden {
    display: none;
  }

  /* ===== Command Palette ===== */
  .palette {
    width: 560px;
    max-height: 480px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    box-shadow:
      0 0 0 1px rgba(0,0,0,0.1),
      0 20px 50px -12px rgba(0,0,0,0.6),
      0 4px 24px -4px rgba(0,0,0,0.4);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    animation: palette-in 0.15s ease-out;
  }

  @keyframes palette-in {
    from {
      opacity: 0;
      transform: scale(0.96) translateY(-8px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }

  /* Search Input Area */
  .palette-search {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 14px 16px;
    border-bottom: 1px solid var(--border);
  }

  .palette-search-icon {
    flex-shrink: 0;
    color: var(--muted);
  }

  .palette-search input {
    flex: 1;
    background: transparent;
    border: none;
    outline: none;
    color: var(--text);
    font-size: 15px;
    font-family: 'Inter', system-ui, sans-serif;
    caret-color: var(--primary-light);
  }

  .palette-search input::placeholder {
    color: var(--muted);
  }

  .palette-search .search-kbd {
    display: flex;
    align-items: center;
    gap: 3px;
    flex-shrink: 0;
  }

  /* Results Area */
  .palette-results {
    flex: 1;
    overflow-y: auto;
    padding: 6px 0;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }

  .palette-results::-webkit-scrollbar {
    width: 6px;
  }

  .palette-results::-webkit-scrollbar-track {
    background: transparent;
  }

  .palette-results::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 3px;
  }

  /* Section Label */
  .palette-section-label {
    padding: 8px 16px 4px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--muted);
  }

  /* Result Row */
  .palette-row {
    height: 36px;
    display: flex;
    align-items: center;
    padding: 0 16px;
    gap: 10px;
    cursor: pointer;
    transition: background-color 0.08s ease;
    position: relative;
    user-select: none;
  }

  .palette-row:hover {
    background: var(--hover);
  }

  .palette-row.active {
    background: var(--active);
    border-left: 2px solid var(--primary);
    padding-left: 14px;
  }

  .palette-row-icon {
    flex-shrink: 0;
    width: 20px;
    text-align: center;
    font-size: 14px;
    line-height: 1;
  }

  .palette-row-label {
    flex: 1;
    font-size: 13px;
    color: var(--text);
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
  }

  .palette-row-meta {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 11px;
    color: var(--muted);
  }

  .palette-row-meta .score {
    font-weight: 600;
    font-variant-numeric: tabular-nums;
  }

  .palette-row-meta .score.green { color: var(--pass); }
  .palette-row-meta .score.orange { color: var(--review); }
  .palette-row-meta .score.indigo { color: var(--primary-light); }

  .palette-row-meta .status-text {
    font-size: 10px;
    color: var(--muted);
  }

  .palette-row-meta .status-text.pass { color: var(--pass); }
  .palette-row-meta .status-text.review { color: var(--review); }

  /* Severity badges for findings */
  .severity-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 1px 6px;
    border-radius: 3px;
    font-size: 10px;
    font-weight: 600;
    flex-shrink: 0;
  }

  .severity-badge.critical {
    background: rgba(239, 68, 68, 0.15);
    color: var(--fail);
  }

  .severity-badge.major {
    background: rgba(234, 88, 12, 0.15);
    color: #EA580C;
  }

  .finding-preview {
    flex: 1;
    font-size: 12px;
    color: var(--text-secondary);
    font-family: 'JetBrains Mono', monospace;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
  }

  .finding-category {
    font-size: 10px;
    color: var(--muted);
    flex-shrink: 0;
  }

  /* KBD badge */
  .kbd {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 20px;
    height: 20px;
    padding: 0 5px;
    font-size: 11px;
    font-family: 'Inter', system-ui, sans-serif;
    font-weight: 500;
    color: var(--text-secondary);
    background: rgba(51, 65, 85, 0.6);
    border: 1px solid var(--border);
    border-radius: 4px;
    line-height: 1;
  }

  /* Search more link */
  .palette-search-more {
    padding: 8px 16px 4px;
    font-size: 12px;
    color: var(--muted);
    cursor: pointer;
    transition: color 0.1s ease;
  }

  .palette-search-more:hover {
    color: var(--primary-light);
  }

  /* Palette Footer */
  .palette-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 16px;
    border-top: 1px solid var(--border);
    font-size: 11px;
    color: var(--muted);
    flex-shrink: 0;
  }

  .palette-footer-hints {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .palette-footer-hint {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .palette-footer-hint .arrow-keys {
    font-size: 13px;
    line-height: 1;
  }

  /* Processing animation */
  @keyframes pulse-indigo {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  .pulse-indigo {
    animation: pulse-indigo 2s ease-in-out infinite;
  }

  /* Toast */
  #toast {
    position: fixed;
    bottom: 48px;
    right: 20px;
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 13px;
    font-family: 'Inter', system-ui, sans-serif;
    display: flex;
    align-items: center;
    gap: 8px;
    z-index: 200;
    transform: translateY(24px);
    opacity: 0;
    transition: transform 0.25s ease, opacity 0.25s ease;
    pointer-events: none;
  }

  #toast.show {
    transform: translateY(0);
    opacity: 1;
  }

  #toast.success {
    background: var(--pass);
    color: white;
  }

  #toast.info {
    background: var(--primary);
    color: white;
  }

  /* No results */
  .palette-no-results {
    padding: 24px 16px;
    text-align: center;
    color: var(--muted);
    font-size: 13px;
  }

  /* Ctrl+K hint badge in background */
  .ctrl-k-hint {
    display: inline-flex;
    align-items: center;
    gap: 3px;
    cursor: pointer;
  }
</style>
</head>
<body>

<!-- ===== Background: Simplified Review View (blurred) ===== -->
<div id="background-view">
  <!-- Sidebar -->
  <div class="bg-sidebar">
    <div class="bg-sidebar-logo">Q</div>
    <div class="bg-sidebar-divider"></div>
    <div class="bg-sidebar-icon" title="Dashboard">
      <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
    </div>
    <div class="bg-sidebar-icon active" title="Review">
      <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
    </div>
    <div class="bg-sidebar-icon" title="Reports">
      <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
    </div>
    <div class="bg-sidebar-icon" title="Settings">
      <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.066 2.573c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.573 1.066c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.066-2.573c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="bg-main">
    <!-- Top Bar -->
    <div class="bg-topbar">
      <div class="bg-breadcrumb">
        <span>Dashboard</span>
        <span class="sep">/</span>
        <span>Client-ABC</span>
        <span class="sep">/</span>
        <span>Monday Batch</span>
        <span class="sep">/</span>
        <span class="current">user-guide-03.xlf</span>
      </div>
      <div class="bg-score-badge">
        <span style="font-size:12px;color:var(--muted)">Reviewed: 14/28</span>
        <span class="bg-score-num">82</span>
      </div>
    </div>

    <!-- Filter Bar -->
    <div class="bg-filterbar">
      <span>Filter:</span>
      <span class="bg-filter-pill">Severity: All</span>
      <span class="bg-filter-pill">Layer: All</span>
      <span class="bg-filter-pill">Status: Pending</span>
      <span style="flex:1"></span>
      <span>Showing 14 of 28 findings</span>
    </div>

    <!-- Finding Rows -->
    <div class="bg-content">
      <div class="bg-finding-row">
        <span class="bg-finding-num">1</span>
        <span class="bg-severity-dot major"></span>
        <span class="bg-finding-text">"app" -> "&#3649;&#3629;&#3611;" vs "&#3649;&#3629;&#3614;"</span>
        <span class="bg-finding-status" style="color:var(--pass)">Accepted</span>
      </div>
      <div class="bg-finding-row">
        <span class="bg-finding-num">2</span>
        <span class="bg-severity-dot minor"></span>
        <span class="bg-finding-text">"500" -> "&#3669;&#3664;&#3664;" format</span>
        <span class="bg-finding-status" style="color:var(--pass)">Accepted</span>
      </div>
      <div class="bg-finding-row" style="border-left:3px solid var(--primary);">
        <span class="bg-finding-num">3</span>
        <span class="bg-severity-dot critical"></span>
        <span class="bg-finding-text">"bank account" -> "&#3619;&#3636;&#3617;&#3613;&#3633;&#3656;&#3591;&#3649;&#3617;&#3656;&#3609;&#3657;&#3635;"</span>
        <span class="bg-finding-status">Pending</span>
      </div>
      <div class="bg-finding-row">
        <span class="bg-finding-num">4</span>
        <span class="bg-severity-dot critical"></span>
        <span class="bg-finding-text">"quarterly" -> "&#3619;&#3634;&#3618;&#3648;&#3604;&#3639;&#3629;&#3609;"</span>
        <span class="bg-finding-status">Pending</span>
      </div>
      <div class="bg-finding-row">
        <span class="bg-finding-num">5</span>
        <span class="bg-severity-dot major"></span>
        <span class="bg-finding-text">"has been sent" -> "&#3606;&#3641;&#3585;&#3626;&#3656;&#3591;" passive</span>
        <span class="bg-finding-status">Pending</span>
      </div>
      <div class="bg-finding-row">
        <span class="bg-finding-num">6</span>
        <span class="bg-severity-dot major"></span>
        <span class="bg-finding-text">"utilize" -> "&#3651;&#3594;&#3657;&#3611;&#3619;&#3632;&#3650;&#3618;&#3594;&#3609;&#3660;" (idiom OK)</span>
        <span class="bg-finding-status" style="color:var(--fail)">Rejected</span>
      </div>
      <div class="bg-finding-row">
        <span class="bg-finding-num">7</span>
        <span class="bg-severity-dot major"></span>
        <span class="bg-finding-text">"dashboard" -> "&#3649;&#3604;&#3594;&#3610;&#3629;&#3619;&#3660;&#3604;" not "&#3627;&#3609;&#3657;&#3634;&#3627;&#3621;&#3633;&#3585;"</span>
        <span class="bg-finding-status">Pending</span>
      </div>
      <div class="bg-finding-row">
        <span class="bg-finding-num">8</span>
        <span class="bg-severity-dot major"></span>
        <span class="bg-finding-text">"workflow" -> "&#3586;&#3633;&#3657;&#3609;&#3605;&#3629;&#3609;&#3585;&#3634;&#3619;&#3607;&#3635;&#3591;&#3634;&#3609;"</span>
        <span class="bg-finding-status" style="color:var(--review)">Flagged</span>
      </div>
    </div>

    <!-- Status Bar -->
    <div class="bg-statusbar">
      <div style="display:flex;align-items:center;gap:12px;">
        <span>EN -> TH</span>
        <span style="color:var(--border)">|</span>
        <span>4,200 segments</span>
        <span style="color:var(--border)">|</span>
        <span>Thorough mode</span>
      </div>
      <div style="display:flex;align-items:center;gap:12px;" class="ctrl-k-hint">
        <span style="display:flex;align-items:center;gap:4px;">
          <span style="width:6px;height:6px;border-radius:50%;background:var(--primary-light);" class="pulse-indigo"></span>
          AI L3 processing...
        </span>
        <span style="color:var(--border)">|</span>
        <span><span class="kbd" style="font-size:10px">Ctrl</span>+<span class="kbd" style="font-size:10px">K</span> Command</span>
      </div>
    </div>
  </div>
</div>

<!-- ===== Command Palette Overlay ===== -->
<div id="palette-backdrop">
  <div class="palette" id="palette-modal">

    <!-- Search Input -->
    <div class="palette-search">
      <svg class="palette-search-icon" width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
      </svg>
      <input type="text" id="palette-input" placeholder="Search actions, files, findings..." autofocus spellcheck="false" autocomplete="off">
      <div class="search-kbd">
        <span class="kbd" style="font-size:10px;">Esc</span>
      </div>
    </div>

    <!-- Results -->
    <div class="palette-results" id="palette-results">

      <!-- ACTIONS Section -->
      <div class="palette-section-label" data-section="actions">Actions</div>

      <div class="palette-row active" data-type="action" data-search="accept finding" data-action="accept" onclick="selectResult(this)">
        <span class="palette-row-icon" style="color:var(--pass);">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"/></svg>
        </span>
        <span class="palette-row-label">Accept Finding</span>
        <span class="palette-row-meta">
          <span class="kbd">A</span>
        </span>
      </div>

      <div class="palette-row" data-type="action" data-search="reject finding" data-action="reject" onclick="selectResult(this)">
        <span class="palette-row-icon" style="color:var(--fail);">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"/></svg>
        </span>
        <span class="palette-row-label">Reject Finding</span>
        <span class="palette-row-meta">
          <span class="kbd">R</span>
        </span>
      </div>

      <div class="palette-row" data-type="action" data-search="flag for review" data-action="flag" onclick="selectResult(this)">
        <span class="palette-row-icon" style="color:var(--review);">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M4 4v16h2V13h5l1 2h7V4H12l-1 2H6V4H4z"/></svg>
        </span>
        <span class="palette-row-label">Flag for Review</span>
        <span class="palette-row-meta">
          <span class="kbd">F</span>
        </span>
      </div>

      <div class="palette-row" data-type="action" data-search="add note" data-action="note" onclick="selectResult(this)">
        <span class="palette-row-icon" style="color:var(--primary-light);">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
        </span>
        <span class="palette-row-label">Add Note</span>
        <span class="palette-row-meta">
          <span class="kbd">N</span>
        </span>
      </div>

      <div class="palette-row" data-type="action" data-search="undo last action" data-action="undo" onclick="selectResult(this)">
        <span class="palette-row-icon" style="color:var(--text-secondary);">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a5 5 0 015 5v2M3 10l4-4M3 10l4 4"/></svg>
        </span>
        <span class="palette-row-label">Undo Last Action</span>
        <span class="palette-row-meta">
          <span class="kbd" style="font-size:10px;">Ctrl</span><span style="color:var(--muted);margin:0 1px;">+</span><span class="kbd">Z</span>
        </span>
      </div>

      <div class="palette-row" data-type="action" data-search="export report" data-action="export" onclick="selectResult(this)">
        <span class="palette-row-icon" style="color:var(--text-secondary);">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
        </span>
        <span class="palette-row-label">Export Report</span>
        <span class="palette-row-meta"></span>
      </div>

      <!-- FILES Section -->
      <div class="palette-section-label" data-section="files">Files</div>

      <div class="palette-row" data-type="file" data-search="user-guide-01.xlf" data-action="file-1" onclick="selectResult(this)">
        <span class="palette-row-icon" style="color:var(--text-secondary);">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
        </span>
        <span class="palette-row-label">user-guide-01.xlf</span>
        <span class="palette-row-meta">
          <span class="score green">97</span>
          <span class="status-text pass">Passed</span>
        </span>
      </div>

      <div class="palette-row" data-type="file" data-search="user-guide-02.xlf" data-action="file-2" onclick="selectResult(this)">
        <span class="palette-row-icon" style="color:var(--text-secondary);">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
        </span>
        <span class="palette-row-label">user-guide-02.xlf</span>
        <span class="palette-row-meta">
          <span class="score orange">78</span>
          <span class="status-text review">Need Review</span>
        </span>
      </div>

      <div class="palette-row" data-type="file" data-search="admin-panel-01.xlf" data-action="file-3" onclick="selectResult(this)">
        <span class="palette-row-icon" style="color:var(--text-secondary);">
          <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
        </span>
        <span class="palette-row-label">admin-panel-01.xlf</span>
        <span class="palette-row-meta">
          <span class="score indigo pulse-indigo">88</span>
          <span class="status-text" style="color:var(--primary-light);">Processing...</span>
        </span>
      </div>

      <!-- FINDINGS Section -->
      <div class="palette-section-label" data-section="findings">Findings</div>

      <div class="palette-row" data-type="finding" data-search="#3 critical bank account terminology" data-action="finding-3" onclick="selectResult(this)">
        <span class="palette-row-icon" style="font-size:12px;color:var(--muted);font-variant-numeric:tabular-nums;">#3</span>
        <span class="severity-badge critical">Critical</span>
        <span class="finding-preview">"bank account" &rarr; "&#3619;&#3636;&#3617;&#3613;&#3633;&#3656;&#3591;&#3649;&#3617;&#3656;&#3609;&#3657;&#3635;"</span>
        <span class="finding-category">Terminology</span>
      </div>

      <div class="palette-row" data-type="finding" data-search="#7 major dashboard glossary" data-action="finding-7" onclick="selectResult(this)">
        <span class="palette-row-icon" style="font-size:12px;color:var(--muted);font-variant-numeric:tabular-nums;">#7</span>
        <span class="severity-badge major">Major</span>
        <span class="finding-preview">"dashboard" &rarr; "&#3649;&#3604;&#3594;&#3610;&#3629;&#3619;&#3660;&#3604;" not "&#3627;&#3609;&#3657;&#3634;&#3627;&#3621;&#3633;&#3585;"</span>
        <span class="finding-category">Glossary</span>
      </div>

      <div class="palette-row" data-type="finding" data-search="#4 critical quarterly mistranslation" data-action="finding-4" onclick="selectResult(this)">
        <span class="palette-row-icon" style="font-size:12px;color:var(--muted);font-variant-numeric:tabular-nums;">#4</span>
        <span class="severity-badge critical">Critical</span>
        <span class="finding-preview">"quarterly" &rarr; "&#3619;&#3634;&#3618;&#3648;&#3604;&#3639;&#3629;&#3609;" (should be &#3619;&#3634;&#3618;&#3652;&#3605;&#3619;&#3617;&#3634;&#3626;)</span>
        <span class="finding-category">Mistranslation</span>
      </div>

      <!-- Search more link -->
      <div class="palette-search-more" id="search-more" onclick="showToast('Searching server...', 'info')">
        Search server for more...
      </div>

    </div>

    <!-- Footer -->
    <div class="palette-footer">
      <div class="palette-footer-hints">
        <span class="palette-footer-hint">
          <span class="arrow-keys">&uarr;&darr;</span> Navigate
        </span>
        <span style="color:var(--border);">&middot;</span>
        <span class="palette-footer-hint">
          <span style="font-size:11px;">Enter</span> Select
        </span>
        <span style="color:var(--border);">&middot;</span>
        <span class="palette-footer-hint">
          <span style="font-size:11px;">Esc</span> Close
        </span>
      </div>
      <div style="color:var(--muted);font-size:11px;">
        Tab to switch sections
      </div>
    </div>

  </div>
</div>

<!-- Toast Notification -->
<div id="toast"></div>

<script>
(function() {
  'use strict';

  const backdrop = document.getElementById('palette-backdrop');
  const input = document.getElementById('palette-input');
  const resultsContainer = document.getElementById('palette-results');
  const bgView = document.getElementById('background-view');

  // --- Open / Close ---
  function openPalette() {
    backdrop.classList.remove('hidden');
    bgView.classList.remove('clear');
    input.value = '';
    filterResults('');
    input.focus();
    // Reset active to first row
    const rows = getVisibleRows();
    setActiveRow(rows[0]);
  }

  function closePalette() {
    backdrop.classList.add('hidden');
    bgView.classList.add('clear');
  }

  // --- Get visible rows ---
  function getVisibleRows() {
    return Array.from(resultsContainer.querySelectorAll('.palette-row')).filter(
      r => r.style.display !== 'none'
    );
  }

  // --- Active row management ---
  function setActiveRow(row) {
    if (!row) return;
    resultsContainer.querySelectorAll('.palette-row').forEach(r => r.classList.remove('active'));
    row.classList.add('active');
    // Scroll into view if needed
    row.scrollIntoView({ block: 'nearest' });
  }

  function getActiveRow() {
    return resultsContainer.querySelector('.palette-row.active');
  }

  function moveActive(direction) {
    const rows = getVisibleRows();
    if (!rows.length) return;
    const current = getActiveRow();
    let idx = rows.indexOf(current);
    if (idx === -1) idx = 0;
    else idx += direction;
    if (idx < 0) idx = rows.length - 1;
    if (idx >= rows.length) idx = 0;
    setActiveRow(rows[idx]);
  }

  // --- Filtering ---
  function filterResults(query) {
    const q = query.toLowerCase().trim();
    const rows = resultsContainer.querySelectorAll('.palette-row');
    const sections = resultsContainer.querySelectorAll('.palette-section-label');
    const searchMore = document.getElementById('search-more');

    // Track which sections have visible rows
    const sectionVisibility = { actions: false, files: false, findings: false };

    rows.forEach(row => {
      const searchText = (row.getAttribute('data-search') || '').toLowerCase();
      const label = (row.querySelector('.palette-row-label') || row.querySelector('.finding-preview') || {}).textContent || '';
      const match = !q || searchText.includes(q) || label.toLowerCase().includes(q);
      row.style.display = match ? '' : 'none';

      if (match) {
        const type = row.getAttribute('data-type');
        if (type === 'action') sectionVisibility.actions = true;
        if (type === 'file') sectionVisibility.files = true;
        if (type === 'finding') sectionVisibility.findings = true;
      }
    });

    // Show/hide section labels
    sections.forEach(sec => {
      const sectionName = sec.getAttribute('data-section');
      sec.style.display = sectionVisibility[sectionName] ? '' : 'none';
    });

    // Show "search more" only if query is present
    if (searchMore) {
      searchMore.style.display = q ? '' : '';
    }

    // Set first visible row as active
    const visibleRows = getVisibleRows();
    if (visibleRows.length) {
      setActiveRow(visibleRows[0]);
    }
  }

  // --- Toast ---
  window.showToast = function(message, type) {
    const toast = document.getElementById('toast');
    toast.textContent = '';
    toast.className = '';

    const icon = document.createElement('span');
    if (type === 'success') {
      icon.textContent = '\u2713 ';
      toast.classList.add('success');
    } else {
      icon.textContent = '\u2139 ';
      toast.classList.add('info');
    }
    toast.appendChild(icon);
    toast.appendChild(document.createTextNode(message));
    toast.classList.add('show');

    setTimeout(() => {
      toast.classList.remove('show');
    }, 2500);
  };

  // --- Select a result ---
  window.selectResult = function(row) {
    const action = row.getAttribute('data-action');
    const label = (row.querySelector('.palette-row-label') || row.querySelector('.finding-preview') || {}).textContent || 'Item';

    const messages = {
      'accept': 'Finding accepted. Score: 82 -> 87',
      'reject': 'Finding rejected.',
      'flag': 'Finding flagged for review.',
      'note': 'Note dialog opened.',
      'undo': 'Last action undone.',
      'export': 'Exporting report...',
      'file-1': 'Opened user-guide-01.xlf',
      'file-2': 'Opened user-guide-02.xlf',
      'file-3': 'Opened admin-panel-01.xlf',
      'finding-3': 'Navigated to Finding #3',
      'finding-7': 'Navigated to Finding #7',
      'finding-4': 'Navigated to Finding #4',
    };

    const msg = messages[action] || 'Selected: ' + label;
    const type = (action === 'accept' || action === 'file-1') ? 'success' : 'info';

    closePalette();
    showToast(msg, type);
  };

  // --- Input handler ---
  input.addEventListener('input', function() {
    filterResults(this.value);
  });

  // --- Keyboard handling ---
  document.addEventListener('keydown', function(e) {
    const isOpen = !backdrop.classList.contains('hidden');

    // Ctrl+K to toggle
    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
      e.preventDefault();
      if (isOpen) {
        closePalette();
      } else {
        openPalette();
      }
      return;
    }

    if (!isOpen) return;

    // Escape to close
    if (e.key === 'Escape') {
      e.preventDefault();
      closePalette();
      return;
    }

    // Arrow up/down
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      moveActive(1);
      return;
    }

    if (e.key === 'ArrowUp') {
      e.preventDefault();
      moveActive(-1);
      return;
    }

    // Enter to select
    if (e.key === 'Enter') {
      e.preventDefault();
      const active = getActiveRow();
      if (active) selectResult(active);
      return;
    }

    // Tab to cycle sections
    if (e.key === 'Tab') {
      e.preventDefault();
      const visibleRows = getVisibleRows();
      if (!visibleRows.length) return;

      const active = getActiveRow();
      const currentType = active ? active.getAttribute('data-type') : '';
      const sectionOrder = ['action', 'file', 'finding'];
      const currentIdx = sectionOrder.indexOf(currentType);

      // Find next section with visible rows
      for (let i = 1; i <= sectionOrder.length; i++) {
        const nextType = sectionOrder[(currentIdx + (e.shiftKey ? -i + sectionOrder.length : i)) % sectionOrder.length];
        const firstInSection = visibleRows.find(r => r.getAttribute('data-type') === nextType);
        if (firstInSection) {
          setActiveRow(firstInSection);
          break;
        }
      }
      return;
    }
  });

  // --- Click backdrop to close ---
  backdrop.addEventListener('click', function(e) {
    if (e.target === backdrop) {
      closePalette();
    }
  });

  // --- Initial state: palette open ---
  // Focus input on load
  setTimeout(() => { input.focus(); }, 100);

})();
</script>

</body>
</html>